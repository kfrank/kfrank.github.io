{"componentChunkName":"component---src-templates-blog-post-js","path":"/building-a-music-player-in-pure-javascript/","result":{"data":{"site":{"siteMetadata":{"title":"Klare Frank, product designer","author":"Klare Frank"}},"markdownRemark":{"id":"041aa3e0-5871-5edd-9042-2dddefcbacd4","excerpt":"I will preface this by saying I’m no expert in building javascript web apps from scratch. Most of the work I do using Javascript involves page interactions…","html":"<p>I will preface this by saying I’m no expert in building javascript web apps from scratch. Most of the work I do using Javascript involves page interactions, working with apis, and prototyping. When my friend Courtney approached me with the idea to do a parody of our friends weekly playlist, This Week’s Playlist, I figured at the very least it would be a great way to exercise some js skills while putting my love of all types of music out there. This Week’s Playlist is a curated weekly playlist of (mostly) new music. Part of our goal for our parody, Next Week’s Playlist (launching on April Fool’s Day, of course), was to also focus on mostly new music, predicting what should be on next week’s This Week’s Playlist.</p>\n<p>I decided early on to test myself by only using pure javascript instead of relying on jquery. The first time I decided to not use jquery was on my coding assignment for my job application to Treehouse, where the functionality I wanted to accomplish was so small that adding an extra second of load time just to make five lines of code work seemed superfluous. While I knew there would be significantly more lines of code needed for Next Week’s Playlist, it seemed like a good opportunity to test out building in pure javascript.</p>\n<h2>Planning out the functionality</h2>\n<p>I started by compiling a list of things we wanted the site to do, starting with the bare minimum needed for it to work:</p>\n<ul>\n<li>When a user clicks on a song, play the song</li>\n<li>If a user clicks on a song that is playing, pause the song</li>\n<li>When a song ends, play the next song</li>\n<li>When a user presses the spacebar for the first time, play the first song</li>\n<li>When a user presses the spacebar and a song is playing, pause the song</li>\n<li>When a user presses the spacebar and a song is paused, play the song</li>\n</ul>\n<p>We also wanted to add a feature to allow for links to external music services (if the song was available) and decided on a maximum of three: soundcloud, spotify, and rdio (rip, rdio):</p>\n<ul>\n<li>When a user clicks on a links button, toggle the links to external music services</li>\n</ul>\n<h2>Starting with interactions</h2>\n<p>I usually start projects by laying out the interactions. In this case, it’s a spacebar press and when a track gets clicked.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Get all elements with a class of track\nvar trackList = document.querySelectorAll(&#39;.track&#39;);\n\n// When the spacebar is pressed\ndocument.addEventListener(&#39;keypress&#39;, function(key){\nif( key.keyCode == 32 ){\n\n}\n});\n\n// When .track is clicked\nfunction playPause(){\ntrackList[i].addEventListener(&#39;click&#39;, function(e){\n\n});\n}\n\n// Applying the function to all .track elements\nfor ( i=0; i &lt; trackList.length; i++ ) {\nplayPause();\n}</code></pre></div>\n<h2>Using track index instead of attributes</h2>\n<p>Next Week’s Playlist works by getting the value of the audio attribute on a selected track. Since all tracks are meant to be listed in numerical order, I decided to take this a step forward and get the index (+1) of the selected track.</p>\n<p>We’ll use a function to find the index of the selected song (either the song that is clicked or the song that is playing):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function findIndex(el){\nvar i=1;\nwhile(el.previousSibling){\nel = el.previousSibling;\nif(el.nodeType === 1){\ni++;\n}\n}\nreturn i;\n}</code></pre></div>\n<h2>Adding play and paused classes</h2>\n<p>Next, I added in the appropriate classes based on my base interactions. (Note that we’re still not introducing sound yet.)</p>\n<p>First, we’ll need a function to check for if an element has a class:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// A function to check if an element has a class\nfunction hasClass(el, cls) {\nreturn el.className &amp;&amp; new RegExp(&#39;(\\\\s|^)&#39; + cls + &#39;(\\\\s|\\$)&#39;).test(el.className);\n}</code></pre></div>\n<p>For a spacebar press, I’ll add a class of playing to the first song if nothing has been played yet, and a class of activated to the playlist so that I can style it a bit.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// When the spacebar is pressed\ndocument.addEventListener(&#39;keypress&#39;, function(key){\nif( key.keyCode == 32 ){\n// If no songs have been played yet\nif (document.querySelectorAll(&#39;.playing&#39;).length == 0) {\nindex = 0, // Setting the song index\ntrackList[index].parentNode.classList.add(&#39;playing&#39;),\ndocument.querySelectorAll(&#39;.playlist&#39;)[0].classList.add(&#39;activated&#39;);\n} else if ( trackList[index].parentNode.classList[1] == &#39;paused&#39; ) {\n// If a user pressed the spacebar when a song is paused, play the song\ntrackList[index].parentNode.classList.remove(&#39;paused&#39;);\n} else {\n// If a user pressed the spacebar when a song is playing, pause the song\ntrackList[index].parentNode.classList.add(&#39;paused&#39;);\n}\nkey.preventDefault();\n}\n});</code></pre></div>\n<p>For a song click, we’ll add similar classes of activated, playing, and paused:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// When .track is clicked\nfunction playPause(){\ntrackList[i].addEventListener(&#39;click&#39;, function(e){\n// Saves li instead of a\nvar selected = this.parentNode;\n// Finds index of the selected li\nindex = findIndex(selected);\n\n    // If a song is being played for the first time, add a class to .playlist\n    if( !hasClass(document.querySelectorAll(&#39;.playlist&#39;)[0], &#39;activated&#39;) ){\n      document.querySelectorAll(&#39;.playlist&#39;)[0].classList.add(&#39;activated&#39;);\n    }\n\n    // If selected\n    if( hasClass(selected, &#39;playing&#39;) || (document.querySelectorAll(&#39;.playing&#39;).length !== 0)){\n      if (!hasClass(selected, &#39;playing&#39;) &amp;&amp; (document.querySelectorAll(&#39;.playing&#39;).length !== 0)) {\n        if (selected.parentNode.hasChildNodes()){\n          var children = selected.parentNode.childNodes;\n          for (var i = 1; i &lt; children.length; i+=2) {\n            children[i].classList.remove(&#39;playing&#39;,&#39;paused&#39;);\n          }\n        };\n      }\n    }\n\n      e.preventDefault();\n\n      return song.play(),\n      selected.classList.add(&#39;playing&#39;);\n      if (!hasClass(selected, &#39;paused&#39;) &amp;&amp; song.currentTime &gt; 0) {\n        song.pause(),\n        selected.classList.add(&#39;paused&#39;);\n      } else {\n\n      }\n      !hasClass(selected, &#39;paused&#39;) &amp;&amp; song.currentTime &gt; 0 ? (song.pause(), selected.classList.add(&#39;paused&#39;)) : hasClass(selected, &#39;paused&#39;) &amp;&amp; song.currentTime &gt; 0 &amp;&amp; selected.classList.remove(&#39;paused&#39;); !1;\n\n});\n}</code></pre></div>\n<h2>Adding in extra features</h2>\n<p>One of the big requests that Courtney received was the ability to scrub through a track. I use this a lot on Soundcloud and Rdio to see if the track has enough pull to even consider listening all the way through and eventually put on Next Week’s Playlist.</p>\n<p>To accomplish this, we need to track the position of the mouse click along one axis in the progress bar.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Get click point</code></pre></div>\n<p>From there, we can calculate the percentage and apply it to the track.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Apply it to current audio</code></pre></div>\n<h2>Limitations</h2>\n<p>The way I used javascript requires everything in the html to be in its proper order. Using jquery to grab a sibling by element instead of using javascript to grab a sibling by node index is a lot more forgiving.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\\$(this).siblings(&#39;li&#39;).children(&#39;.track&#39;);\n\n// compared to:\n\nthis.parentNode.childNodes[0];</code></pre></div>\n<h2>Takeaways</h2>\n<p>While this was an interesting exercise in creating something using pure javascript, it could be done easier using libraries. It also doesn’t take into consideration pulling in tracks from different sources; it’s definitely a first iteration. That being said, we shouldn’t be automatically turning to JQuery for everything, especially when it could be written as simply and load way faster without a library.</p>","frontmatter":{"title":"Building a music player with pure javascript","date":"April 15, 2015","posttype":"blog"}}},"pageContext":{"slug":"/building-a-music-player-in-pure-javascript/"}}}