<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
      <title>Klare - Thoughts from a designer/developer</title>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta http-equiv="content-language" content="en-gb">
      <meta name="copyright" content="Klare Frank">
      <meta name="description" content="Portfolio and Blog of Klare Frank">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <script src="//use.typekit.net/laf4xea.js"></script>
      <script>try{Typekit.load();}catch(e){}</script>
      <link rel="stylesheet" type="text/css" href="/css/main.css" />
      <!-- <link rel="stylesheet" href="/css/syntax.css"> -->
      <link rel="stylesheet" href="/css/solarized-dark.css">
      <link href="atom.xml" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">

      <!-- favicon -->
      <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72-precomposed.png">
      <link rel="icon" type="image/png" href="favicon.ico" sizes="16x16">
      <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
  </head>

  <body>
    <!--[if lt IE 8]>
        <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    
  <header class="header--interior">
  <h1><a href="/" title="Back to Homepage">Klare</a></h1>
  <nav role="navigation">
    <ul>
      <li><a  href="/#work">Work</a></li>
      <li><a class="active" href="/#thoughts">Thoughts</a></li>
      <li><a href="/about">About</a></li>
    </ul>
  </nav>
</header>


  <article class="page page--thoughts">



  <time datetime="2015-04-15T09:57:51-07:00">
    15 April 2015
  </time>

  
<h1 class="page-title">Building a music player with pure javascript</h1>
  
   
  <div class="content--post">
    <p>I will preface this by saying I’m no expert in building javascript web apps from scratch. Most of the work I do using Javascript involves page interactions, working with apis, and prototyping. When my friend Courtney approached me with the idea to do a parody of our friends weekly playlist, This Week’s Playlist, I figured at the very least it would be a great way to exercise some js skills while putting my love of all types of music out there. This Week’s Playlist is a curated weekly playlist of (mostly) new music. Part of our goal for our parody, Next Week’s Playlist (launching on April Fool’s Day, of course), was to also focus on mostly new music, predicting what should be on next week’s This Week’s Playlist.</p>

<p>I decided early on to test myself by only using pure javascript instead of relying on jquery. The first time I decided to not use jquery was on my coding assignment for my job application to Treehouse, where the functionality I wanted to accomplish was so small that adding an extra second of load time just to make five lines of code work seemed superfluous. While I knew there would be significantly more lines of code needed for Next Week’s Playlist, it seemed like a good opportunity to test out building in pure javascript.</p>

<h2>Planning out the functionality</h2>

<p>I started by compiling a list of things we wanted the site to do, starting with the bare minimum needed for it to work:</p>

<ul>
<li>When a user clicks on a song, play the song</li>
<li>If a user clicks on a song that is playing, pause the song</li>
<li>When a song ends, play the next song</li>
<li>When a user presses the spacebar for the first time, play the first song</li>
<li>When a user presses the spacebar and a song is playing, pause the song</li>
<li>When a user presses the spacebar and a song is paused, play the song</li>
</ul>


<p>We also wanted to add a feature to allow for links to external music services (if the song was available) and decided on a maximum of three: soundcloud, spotify, and rdio:</p>

<ul>
<li>When a user clicks on a links button, toggle the links to external music services</li>
</ul>


<h2>Starting with interactions</h2>

<p>I usually start projects by laying out the interactions. In this case, it’s a spacebar press and when a track gets clicked.</p>

<pre><code>// Get all elements with a class of track
var trackList = document.querySelectorAll('.track');

// When the spacebar is pressed
document.addEventListener('keypress', function(key){
  if( key.keyCode == 32 ){

  }
});

// When .track is clicked
function playPause(){
  trackList[i].addEventListener('click', function(e){

  });
}

// Applying the function to all .track elements
for ( i=0; i &lt; trackList.length; i++ ) {
  playPause();
}
</code></pre>

<h2>Using track index instead of attributes</h2>

<p>This Week’s Playlist works by getting the value of the audio attribute on a selected track. Since all tracks are meant to be listed in numerical order, I decided to take this a step forward and get the index (+1) of the selected track.</p>

<p>We’ll use a function to find the index of the selected song (either the song that is clicked or the song that is playing):</p>

<pre><code>function findIndex(el){
  var i=1;
  while(el.previousSibling){
    el = el.previousSibling;
    if(el.nodeType === 1){
      i++;
    }
  }
  return i;
}
</code></pre>

<h2>Adding play and paused classes</h2>

<p>Next, I added in the appropriate classes based on my base interactions. (Note that we’re still not introducing sound yet.)</p>

<p>First, we’ll need a function to check for if an element has a class:</p>

<pre><code>// A function to check if an element has a class
function hasClass(el, cls) { 
  return el.className &amp;&amp; new RegExp('(\\s|^)' + cls + '(\\s|$)').test(el.className);
}
</code></pre>

<p>For a spacebar press, I’ll add a class of playing to the first song if nothing has been played yet, and a class of activated to the playlist so that I can style it a bit.</p>

<pre><code>// When the spacebar is pressed
document.addEventListener('keypress', function(key){
  if( key.keyCode == 32 ){
    // If no songs have been played yet
    if (document.querySelectorAll('.playing').length == 0) {
      index = 0, // Setting the song index
      trackList[index].parentNode.classList.add('playing'),
      document.querySelectorAll('.playlist')[0].classList.add('activated');
    } else if ( trackList[index].parentNode.classList[1] == 'paused' ) {
    // If a user pressed the spacebar when a song is paused, play the song
      trackList[index].parentNode.classList.remove('paused');
    } else {
    // If a user pressed the spacebar when a song is playing, pause the song
      trackList[index].parentNode.classList.add('paused');
    }
    key.preventDefault();
  }
});
</code></pre>

<p>For a song click, we'll add similar classes of activated, playing, and paused:</p>

<pre><code>// When .track is clicked
function playPause(){
  trackList[i].addEventListener('click', function(e){
    // Saves li instead of a
    var selected = this.parentNode;
    // Finds index of the selected li
    index = findIndex(selected);

    // If a song is being played for the first time, add a class to .playlist
    if( !hasClass(document.querySelectorAll('.playlist')[0], 'activated') ){
      document.querySelectorAll('.playlist')[0].classList.add('activated');
    }

    // If selected 
    if( hasClass(selected, 'playing') || (document.querySelectorAll('.playing').length !== 0)){
      if (!hasClass(selected, 'playing') &amp;&amp; (document.querySelectorAll('.playing').length !== 0)) {
        if (selected.parentNode.hasChildNodes()){
          var children = selected.parentNode.childNodes;
          for (var i = 1; i &lt; children.length; i+=2) {
            children[i].classList.remove('playing','paused');
          }
        };
      }
    } 

      e.preventDefault();

      return song.play(),
      selected.classList.add('playing');
      if (!hasClass(selected, 'paused') &amp;&amp; song.currentTime &gt; 0) {
        song.pause(),
        selected.classList.add('paused');
      } else {

      }
      !hasClass(selected, 'paused') &amp;&amp; song.currentTime &gt; 0 ? (song.pause(), selected.classList.add('paused')) : hasClass(selected, 'paused') &amp;&amp; song.currentTime &gt; 0 &amp;&amp; selected.classList.remove('paused'); !1;
  });
}
</code></pre>

<h2>Adding in extra features</h2>

<p>One of the big requests that Courtney received was the ability to scrub through a track. I use this a lot on Soundcloud and Rdio to see if the track has enough pull to even consider listening all the way through and eventually put on Next Week’s Playlist.</p>

<p>To accomplish this, we need to track the position of the mouse click along one axis in the progress bar.</p>

<pre><code>// Get click point
</code></pre>

<p>From there, we can calculate the percentage and apply it to the track.</p>

<pre><code>// Apply it to current audio
</code></pre>

<h2>Criticisms</h2>

<p>The way I used javascript requires everything in the html to be in its proper order. Using jquery to grab a sibling by element instead of using javascript to grab a sibling by node index is a lot more forgiving.</p>

<pre><code>$(this).siblings('li').children('.track');

// compared to:

this.parentNode.childNodes[0];
</code></pre>

<h2>Takeaways</h2>

<p>While this was an interesting exercise in creating something using pure javascript, it could be done easier using libraries. It also doesn't take into consideration pulling in tracks from different sources; it's definitely a first iteration. That being said, we shouldn't be automatically turning to JQuery for everything, especially when it could be written as simply and load way faster without a library.</p>

  </div>
  <div class="nav--share">
    <a href="http://twitter.com/share" class="popup">
      <span class="icon-twitter"></span>
    </a>
  </div>
  
  <div class="paging">
   
    <a rel="prev" href="/getting-started.html" class="paging__link" id="prev">
      <h3>Next up</h3>
      <h4>
        Getting Started
      </h4>
    </a>
  
  <!-- 
    <a rel="next" href="/getting-started.html" class="paging__link" id="next">
      <span class="paging__link__name">
        Getting Started
      </span>
      <span class="paging__link__arrow">
        <svg width="32" height="32" viewBox="0 0 64 64">
        <path d="M29.333 10.667q1.104 0 1.875 0.771l18.667 18.667q0.792 0.792 0.792 1.896t-0.792 1.896l-18.667 18.667q-0.771 0.771-1.875 0.771t-1.885-0.781-0.781-1.885q0-1.125 0.771-1.896l16.771-16.771-16.771-16.771q-0.771-0.771-0.771-1.896 0-1.146 0.76-1.906t1.906-0.76zM13.333 10.667q1.104 0 1.875 0.771l18.667 18.667q0.792 0.792 0.792 1.896t-0.792 1.896l-18.667 18.667q-0.771 0.771-1.875 0.771t-1.885-0.781-0.781-1.885q0-1.125 0.771-1.896l16.771-16.771-16.771-16.771q-0.771-0.771-0.771-1.896 0-1.146 0.76-1.906t1.906-0.76z"></path>
      </svg>
      </span>
    </a>
   -->
  </div>

</article>

<footer>
  <small>Klare Frank</small>
  <ul class="social-buttons"> 
      <li class="social--twitter"><a href="http://twitter.com/klare">
        <svg viewbox="0 0 2000 1625.36" width="24" height="20" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="m 1999.9999,192.4 c -73.58,32.64 -152.67,54.69 -235.66,64.61 84.7,-50.78 149.77,-131.19 180.41,-227.01 -79.29,47.03 -167.1,81.17 -260.57,99.57 C 1609.3399,49.82 1502.6999,0 1384.6799,0 c -226.6,0 -410.328,183.71 -410.328,410.31 0,32.16 3.628,63.48 10.625,93.51 -341.016,-17.11 -643.368,-180.47 -845.739,-428.72 -35.324,60.6 -55.5583,131.09 -55.5583,206.29 0,142.36 72.4373,267.95 182.5433,341.53 -67.262,-2.13 -130.535,-20.59 -185.8519,-51.32 -0.039,1.71 -0.039,3.42 -0.039,5.16 0,198.803 141.441,364.635 329.145,402.342 -34.426,9.375 -70.676,14.395 -108.098,14.395 -26.441,0 -52.145,-2.578 -77.203,-7.364 52.215,163.008 203.75,281.649 383.304,284.946 -140.429,110.062 -317.351,175.66 -509.5972,175.66 -33.1211,0 -65.7851,-1.949 -97.8828,-5.738 181.586,116.4176 397.27,184.359 628.988,184.359 754.732,0 1167.462,-625.238 1167.462,-1167.47 0,-17.79 -0.41,-35.48 -1.2,-53.08 80.1799,-57.86 149.7399,-130.12 204.7499,-212.41">
        </svg>
      </a></li>
      <li class="social--dribbble"><a href="http://dribbble.com/klare">
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 25 25" enable-background="new 0 0 25 25" xml:space="preserve">
        <path d="M12.5,23.828c-6.256,0-11.328-5.071-11.328-11.327c0-6.256,5.072-11.328,11.328-11.328 c6.256,0,11.328,5.072,11.328,11.328S18.756,23.828,12.5,23.828z M21.774,13.689c-2.223-0.292-4.194-0.313-5.951-0.042 c0.727,2.074,1.336,4.307,1.815,6.661C19.861,18.842,21.422,16.455,21.774,13.689z M15.853,21.22 c-0.449-2.627-1.066-4.988-1.861-7.166c-2.975,0.893-5.288,2.803-7.229,5.819c1.585,1.235,3.572,1.977,5.736,1.977 C13.683,21.85,14.811,21.621,15.853,21.22z M3.15,12.5c0,2.313,0.845,4.426,2.236,6.059c2.373-3.479,5.045-5.291,7.962-6.134 c-0.24-0.565-0.489-1.123-0.757-1.666c-2.605,0.785-5.69,1.197-9.422,1.369C3.164,12.252,3.15,12.374,3.15,12.5z M3.361,10.533 c2.945-0.13,5.82-0.457,8.455-1.254C10.812,7.486,9.634,5.802,8.289,4.16C5.807,5.415,3.96,7.739,3.361,10.533z M12.5,3.15 c-0.819,0-1.61,0.116-2.368,0.314c1.299,1.43,2.482,3.17,3.528,5.165c1.819-0.751,3.488-1.785,4.945-3.201 C16.966,4.013,14.836,3.15,12.5,3.15z M19.737,6.582c-1.526,1.546-3.268,2.698-5.336,3.543c0.282,0.609,0.549,1.243,0.807,1.89 c2.099-0.325,4.311-0.253,6.62-0.017C21.719,9.949,20.958,8.073,19.737,6.582z"/>
        </svg>
      </a></li> 
    </ul> 
</footer>


    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49926701-1', 'klare.io');
  ga('send', 'pageview');

</script>

  </body>
</html>
